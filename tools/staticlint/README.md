# Staticlint

Staticlint - это статический анализатор кода на Go, который использует фреймворк `golang.org/x/tools/go/analysis/multichecker` для запуска множества анализаторов.

## Обзор

Анализатор включает:
- **Стандартные анализаторы** из пакета `golang.org/x/tools/go/analysis/passes`
- **Пользовательские анализаторы**:
  - `ErrCheckAnalyzer` - проверка необработанных ошибок
  - `osexit.Analyzer` - проверка прямых вызовов `os.Exit` в функции main
- **Внешние анализаторы**:
  - `ineffassign.Analyzer` - проверка неэффективных присваиваний
  - Анализаторы из `staticcheck` (настраиваются через конфигурационный файл)

## Установка и использование

### Сборка

```bash
go build -o staticlint ./cmd/staticlint
```

### Запуск

```bash
# Анализ текущего пакета
./staticlint .

# Анализ всех пакетов в проекте
./staticlint ./...

# Анализ конкретного пакета
./staticlint ./internal/handler
```

## Конфигурация

Анализатор использует файл `config.json` для настройки анализаторов staticcheck. Файл должен находиться в той же директории, что и исполняемый файл.

Пример конфигурации:

```json
{
    "staticcheck": [
        "SA1001",
        "SA1002",
        "SA1003",
        "SA2000",
        "SA3000",
        "SA4000",
        "SA5000",
        "SA6000",
        "SA9001",
        "S1000",
        "ST1000",
        "QF1000"
    ]
}
```

## Пользовательские анализаторы

### ErrCheckAnalyzer

Проверяет наличие необработанных ошибок в коде. Анализатор находит следующие ситуации:

1. Вызовы функций, возвращающих ошибку, без обработки ошибки
2. Присваивание с использованием '_' для игнорирования ошибки
3. Множественное присваивание с игнорированием ошибки

Примеры обнаруживаемых проблем:

```go
// Ошибка не обработана
func() error { return nil }()

// Ошибка проигнорирована
_, _ := os.Open("file.txt")

// Ошибка проигнорирована в множественном присваивании
a, _ := someFunc()
```

### osexit.Analyzer

Проверяет прямые вызовы `os.Exit` в функции main пакета main. Прямые вызовы `os.Exit` считаются плохой практикой, так как это препятствует корректной очистке ресурсов и обработке ошибок.

Пример обнаруживаемой проблемы:

```go
func main() {
    os.Exit(1)  // прямой вызов os.Exit
}
```

Рекомендуется использовать `return` вместо `os.Exit` в функции main.

## Стандартные анализаторы

Анализатор включает следующие стандартные анализаторы из пакета `golang.org/x/tools/go/analysis/passes`:

- `asmdecl` - проверка объявлений сборки
- `assign` - проверка присваиваний
- `atomic` - проверка атомарных операций
- `bools` - проверка логических выражений
- `buildtag` - проверка тегов сборки
- `cgocall` - проверка вызовов Cgo
- `copylock` - проверка копирования блокировок
- `deepequalerrors` - проверка ошибок в deep equal
- `errorsas` - проверка утверждений типа error
- `httpresponse` - проверка использования http.Response
- `ifaceassert` - проверка утверждений интерфейса
- `loopclosure` - проверка замыканий в циклах
- `lostcancel` - проверка потерянных отмен
- `nilfunc` - проверка сравнений с nil
- `printf` - проверка форматирования printf
- `reflectvaluecompare` - проверка сравнения reflect.Value
- `shadow` - проверка затенения переменных
- `shift` - проверка сдвигов
- `slog` - проверка использования slog
- `stdmethods` - проверка стандартных методов
- `stringintconv` - проверка преобразований строк в числа
- `structtag` - проверка тегов структур
- `testinggoroutine` - проверка горутин в тестах
- `tests` - проверка тестов
- `unmarshal` - проверка unmarshal
- `unreachable` - проверка недостижимого кода
- `unsafeptr` - проверка небезопасных указателей
- `unusedresult` - проверка неиспользуемых результатов

## Внешние анализаторы

### ineffassign

Проверяет неэффективные присваивания, где переменной присваивается значение, которое никогда не используется.

### staticcheck

Набор анализаторов для проверки различных аспектов кода, включая:
- SAxxxx - статические проверки
- Sxxxx - проверки стиля
- STxxxx - проверки стандартов
- QFxxxx - быстрые исправления

## Архитектура

Анализатор использует фреймворк `multichecker` для запуска множества анализаторов. Процесс работы:

1. Загрузка конфигурации из `config.json`
2. Создание списка анализаторов
3. Добавление стандартных, пользовательских и внешних анализаторов
4. Запуск `multichecker.Main` для выполнения анализа
5. Вывод результатов

## Вклад

Для добавления нового анализатора:

1. Создайте новый пакет в директории `cmd/staticlint/`
2. Реализуйте анализатор с интерфейсом `*analysis.Analyzer`
3. Добавьте анализатор в список в функции `main` в `cmd/staticlint/main.go`

## Лицензия

Проект распространяется под лицензией MIT.