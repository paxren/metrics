# План исправления проблемы с ConfigRI

## Краткое резюме проблемы
Переменная `ri` в структуре `ConfigRI` не заполняется, хотя переменная окружения `REPORT_INTERVAL1` установлена. Основная проблема заключается в том, что при использовании спецификатора `required` должна возникать ошибка, если переменная окружения не найдена, но этого не происходит.

## Пошаговый план исправления

### Шаг 1: Диагностика переменных окружения
1. Запустить программу и проверить вывод `env.ToMap(os.Environ())`
2. Убедиться, что `REPORT_INTERVAL1` присутствует в списке переменных окружения
3. Если переменная отсутствует, проверить способ её установки

### Шаг 2: Исправление типа данных
Изменить структуру `ConfigRI` для использования правильного типа данных:

```go
type ConfigRI struct {
    val int64 `env:"REPORT_INTERVAL1,required"`
}
```

### Шаг 3: Исправление использования значения
Заменить закомментированную строку на правильное использование:

```go
if err2 != nil {
    reportInterval = paramReportInterval
} else {
    reportInterval = ri.val  // Использовать распарсенное значение
}
```

### Шаг 4: Добавление отладочной информации
Добавить вывод для диагностики:

```go
fmt.Printf("REPORT_INTERVAL1 from env: %s\n", os.Getenv("REPORT_INTERVAL1"))
```

## Альтернативные решения

### Решение А: Использование строкового типа с преобразованием
Если необходимо сохранить строковый тип:

```go
type ConfigRI struct {
    val string `env:"REPORT_INTERVAL1,required"`
}

// В коде:
if err2 != nil {
    reportInterval = paramReportInterval
} else {
    if val, err := strconv.ParseInt(ri.val, 10, 64); err == nil {
        reportInterval = val
    } else {
        reportInterval = paramReportInterval
    }
}
```

### Решение Б: Установка переменной при запуске
```bash
REPORT_INTERVAL1=10 go run cmd/agent/main.go
```

### Решение В: Использование файла .env
Создать файл `.env` в корне проекта:
```
REPORT_INTERVAL1=10
POLL_INTERVAL=2
```

И изменить код для загрузки из файла:
```go
if err := godotenv.Load(); err != nil {
    log.Println("Error loading .env file")
}
```

## Рекомендуемый порядок действий

1. **Сначала диагностика**: Убедиться, что переменная окружения видна программе
2. **Затем исправление типа**: Изменить `string` на `int64`
3. **Затем исправление использования**: Раскомментировать и использовать `ri.val`
4. **Тестирование**: Проверить работу с различными значениями переменной окружения

## Ожидаемый результат
После исправления кода:
1. При отсутствии `REPORT_INTERVAL1` будет возникать ошибка (как и должно быть с `required`)
2. При наличии переменной её значение будет корректно распарсиваться и использоваться
3. Программа будет работать с установленными интервалами из переменных окружения

## Код для тестирования
```bash
# Тест 1: Без переменной (должна быть ошибка)
unset REPORT_INTERVAL1
go run cmd/agent/main.go

# Тест 2: С переменной
export REPORT_INTERVAL1=15
go run cmd/agent/main.go

# Тест 3: С другим значением
export REPORT_INTERVAL1=30
go run cmd/agent/main.go